@model DataAccessLayer.ViewModels.MenuViewModel
@{
    Layout = "~/Views/Shared/_LayoutCustom.cshtml";
    ViewData["Title"] = " Menu Page";
    ViewBag.Active = "Menu";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/menu.css">
    <title>Menu Page</title>
    <style>
        #additemModal .form-floating>label {
            position: absolute;
            top: 0;
            left: 10px !important;
            opacity: 0.65;
        }

        #edititemModal .form-floating>label {
            position: absolute;
            top: 0;
            left: 10px !important;
            opacity: 0.65;
        }

        #category-container .editButtom,
        #category-container .deleteButton {
            display: none;
        }

        #category-container:hover .editButtom,
        #category-container:hover .deleteButton {
            display: inline-block;
        }

        #modifier-container .editButtom,
        #modifier-container .deleteButton {
            display: none;
        }

        #modifier-container:hover .editButtom,
        #modifier-container:hover .deleteButton {
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="container-fluid p-4">
        <div class="row ">
            <div class="col-4 h2  fw-bold" style="color: #0066A7;">
                Menu
            </div>
        </div>

        <div class="row bg-white p-2 ">
            <nav>
                <div class="nav nav-underline" id="nav-tab" role="tablist">
                    <button class="nav-link tab-btn active" id="nav-home-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                        aria-selected="true"><i class="bi bi-list-check p-1"></i>Items</button>
                    <button class="nav-link tab-btn" id="nav-profile-tab" data-bs-toggle="tab"
                        data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile"
                        aria-selected="false"><i class="bi bi-ui-checks-grid p-1"></i>Modifiers</button>
                </div>
            </nav>
        </div>
        <div class="row bg-white mt-2">
            <div class="col">
                <div class="tab-content " id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab"
                        tabindex="0">
                        <div id="items-content">
                            <partial name="~/Views/Menu/_PartialViewTab.cshtml" />
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab"
                        tabindex="0">
                        <div id="modifier-content">
                            <partial name="~/Views/Menu/_PartialViewModifier.cshtml" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    function openEditModal(categoryId) {
        $.ajax({
            url: '/Menu/EditCategory/' + categoryId,
            type: 'GET',
            success: function (data) {
                if (data) {
                    console.log("Fetched Data:", data);
                    $('#editCategoryId').val(data.categoryid);
                    $('#editCategoryName').val(data.categoryname);
                    $('#editCategoryDescription').val(data.categorydescription);
                    $('#staticBackdrop2').modal('show');
                } else {
                    alert("No category data found.");
                }
            },
            error: function () {
                alert("Failed to load category details.");
            }
        });
    }

    let categoryIdToDelete = null;
    var deleteCategoryId = 0;

    function openDeleteModal(categoryId) {
        console.log("Delete Category ID:", categoryId);
        deleteCategoryId = categoryId;
        $('#deleteModal').modal('show');
    }

    $('#confirmDeleteBtn').click(function () {
        console.log("Deleting Category ID:", deleteCategoryId);
        $.ajax({
            url: '@Url.Action("DeleteCategory", "Menu")',
            type: 'POST',
            data: { categoryId: deleteCategoryId },
            success: function (response) {
                location.reload();
            },
            error: function () {
                toastr.error('An error occurred while deleting the category.');
            }
        });
    });

    $(document).ready(function () {
        $('button[data-bs-toggle="tab"]').on('click', function (e) {
            var target = $(e.target).attr("data-bs-target");

            if (target === '#nav-home') {
                $('#items-content').load('~/Views/Menu/_PartialViewTab.cshtml');
            } else if (target === '#nav-profile') {
                $('#modifier-content').load('~/Views/Menu/_PartialViewModifier.cshtml');
            }
        });
    });
    let deleteItemIds = [];

    @* Now for modifier *@

        function openEditModifierModal(modifierId) {
            $.ajax({
                url: '/Menu/EditModifierGroup/' + modifierId,
                type: 'GET',
                success: function (data) {
                    if (data) {
                        console.log("Fetched Data:", data);
                        $('#editModifierId').val(data.modifiergroupid);
                        $('#editModifierName').val(data.modifiergroupname);
                        $('#editModifierDescription').val(data.modifiergroupdescription);
                        $('#editmodifiermodel').modal('show');
                    } else {
                        alert("No modifier data found.");
                    }
                },
                error: function () {
                    alert("Failed to load modifier details.");
                }
            });
        }
    function openModifierGroupDeleteModal(ModifierId) {
        console.log("Delete Category ID:", ModifierId);
        deleteModifierId = ModifierId;
        $('#deleteModifierGroupModal').modal('show');
    }

    $('#confirmModifierGroupDelete').click(function () {
        console.log("Deleting Modifier ID:", deleteModifierId);
        $.ajax({
            url: '@Url.Action("DeleteModfierGroup", "Menu")',
            type: 'POST',
            data: { modifiergroupid: deleteModifierId },
            success: function (response) {
                location.reload();
            },
            error: function () {
                toastr.error('An error occurred while deleting the category.');
            }
        });
    });

</script>